<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nogaka Anime | Best Anime Site</title>
    <style>
        :root {
            --green: #75A439;
            --teal: #167D9D;
            --dark-purple: #301934;
            --dark-blue: #18203D;
            --text-light: #E0E0E0;
            --text-lighter: #FFFFFF;
            --text-gray: #B0B0B0;
            --bg-dark: #121212;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }

        /* Header Section */
        .header {
            background-color: var(--dark-purple);
            padding: 20px;
            border-bottom: 3px solid var(--teal);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header .logo {
            font-size: 2em;
            font-weight: bold;
            color: var(--green);
        }

        .header nav a {
            color: var(--text-lighter);
            text-decoration: none;
            margin: 0 15px;
            font-size: 1.1em;
            transition: color 0.3s ease;
        }

        .header nav a:hover {
            color: var(--green);
        }

        .controls {
            background: var(--dark-purple);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            margin: 20px;
            text-align: center;
        }

        label, select, input, button {
            font-size: 1em;
            margin: 10px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--teal);
            background-color: var(--dark-blue);
            color: var(--text-light);
        }

        button:hover {
            background: var(--green);
            color: var(--dark-blue);
            cursor: pointer;
        }

        .slider-container {
            margin: 10px auto;
            max-width: 500px;
            text-align: center;
        }

        .slider-label {
            font-size: 1em;
            color: var(--text-lighter);
        }

        #animeContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px;
        }

        .anime-card {
            background: var(--dark-blue);
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.3);
            overflow: hidden;
            text-align: center;
            padding: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .anime-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.4);
        }

        .anime-title {
            font-size: 1.2em;
            color: var(--text-lighter);
            margin-bottom: 10px;
        }

        .anime-description {
            font-size: 0.9em;
            color: var(--text-gray);
        }

        .anime-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        #loading {
            font-size: 1.2em;
            color: var(--text-gray);
            text-align: center;
            margin: 20px;
        }

        #loadMoreBtn {
            display: block;
            margin: 20px auto;
            padding: 12px 25px;
            background: var(--teal);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
        }

        #loadMoreBtn:hover {
            background: var(--green);
        }

        #loadMoreBtn:disabled {
            background: var(--text-gray);
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            #animeContainer {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
    </style>
</head>
<body>
    
  <div id="header-container"></div>
  <div id="footer-container"></div>

    <script>
    // Load Header
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header-container').innerHTML = data;
        initHeaderScripts();
      });

    // Header interactions
    function initHeaderScripts() {
      document.querySelector('.btn-signin')?.addEventListener('click', () => {
        alert('Redirecting to Sign In');
      });
      document.querySelector('.btn-signup')?.addEventListener('click', () => {
        alert('Redirecting to Sign Up');
      });
    }

    // Footer interactions
    function initFooterScripts() {
      const copyright =
        document.querySelector('.footer-bottom p');
      if (copyright) {
        const year = new Date().getFullYear();
        copyright.innerHTML = 
          `&copy; ${year} Nogaka. All rights reserved.`;
      }
    }
    </script>

    <div class="controls">
        <input type="text" id="searchBar" placeholder="Search anime..." oninput="filterBySearch()" />
        <label for="sortOptions">Sort By:</label>
        <select id="sortOptions" onchange="sortAnime()">
            <option value="START_DATE_DESC">Newest</option>
            <option value="POPULARITY_DESC">Popular</option>
            <option value="SCORE_DESC">Highest Rated</option>
        </select>
        <button id="moodToggle" onclick="toggleMoodSearch()">Enable Mood Search</button>
        <div id="moodSearch" class="slider-container" style="display: none;">
            <span class="slider-label" id="sliderValue">Mood: Neutral</span>
            <br>
            <input type="range" min="1" max="3" value="2" id="moodSlider" oninput="filterByMood()" />
        </div>
    </div>

    <div id="animeContainer"></div>
    <div id="loading">Loading...</div>
    <button id="loadMoreBtn" onclick="loadMoreAnime()">Load More Anime</button>

    <script>
        const apiUrl = 'https://graphql.anilist.co';
        let currentPage = 1;
        let hasNextPage = true;
        let animeData = [];
        let filteredAnime = [];
        let moodSearchEnabled = false;
        let currentSort = 'START_DATE_DESC';

        // GraphQL Query (Optimized for 200 anime per page)
        const graphqlQuery = `
        query($page: Int, $sort: [MediaSort]) {
            Page(page: $page, perPage: 200) {
                pageInfo {
                    hasNextPage
                }
                media(type: ANIME, sort: $sort) {
                    id
                    title {
                        romaji
                        english
                    }
                    coverImage {
                        large
                    }
                    description(asHtml: false)
                    genres
                    averageScore
                    trailer {
                        site
                        id
                    }
                }
            }
        }`;

        // Fetch anime with pagination
        function fetchAnime(page = 1, sort = currentSort) {
            const loadingIndicator = document.getElementById('loading');
            const loadMoreBtn = document.getElementById('loadMoreBtn');

            loadingIndicator.style.display = 'block';
            loadMoreBtn.disabled = true;

            fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    query: graphqlQuery,
                    variables: { page, sort },
                }),
            })
            .then(response => response.json())
            .then(data => {
                const newAnime = data.data.Page.media;
                hasNextPage = data.data.Page.pageInfo.hasNextPage;

                if (page === 1) {
                    animeData = newAnime;
                } else {
                    animeData = [...animeData, ...newAnime];
                }

                filteredAnime = [...animeData];
                loadingIndicator.style.display = 'none';
                loadMoreBtn.disabled = false;
                displayAnime(filteredAnime);

                if (!hasNextPage) {
                    loadMoreBtn.style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error fetching anime:', error);
                loadingIndicator.textContent = 'Failed to load anime. Retrying...';
                setTimeout(() => fetchAnime(page, sort), 3000); // Retry after 3s
            });
        }

        // Display anime cards
        function displayAnime(animeList) {
            const animeContainer = document.getElementById('animeContainer');
            
            // Clear only on first load or search
            if (currentPage === 1 || animeList.length < animeData.length) {
                animeContainer.innerHTML = '';
            }

            animeList.forEach(anime => {
                const animeCard = document.createElement('div');
                animeCard.classList.add('anime-card');

                const animeImage = document.createElement('img');
                animeImage.classList.add('anime-image');
                animeImage.src = anime.coverImage.large || 'https://via.placeholder.com/300x400';
                animeImage.alt = anime.title.romaji;

                const animeTitle = document.createElement('p');
                animeTitle.classList.add('anime-title');
                animeTitle.textContent = anime.title.romaji || anime.title.english;

                const animeDescription = document.createElement('p');
                animeDescription.classList.add('anime-description');
                animeDescription.innerHTML = anime.description 
                    ? anime.description.substring(0, 120) + '...' 
                    : 'No description available.';

                // Add clickable trailer link
                animeCard.onclick = () => {
                    if (anime.trailer?.site === 'youtube') {
                        window.open(`https://youtube.com/watch?v=${anime.trailer.id}`, '_blank');
                    }
                };

                animeCard.appendChild(animeImage);
                animeCard.appendChild(animeTitle);
                animeCard.appendChild(animeDescription);
                animeContainer.appendChild(animeCard);
            });
        }

        // Search filter
        function filterBySearch() {
            const searchValue = document.getElementById('searchBar').value.toLowerCase();
            filteredAnime = animeData.filter(anime =>
                anime.title.romaji?.toLowerCase().includes(searchValue) ||
                anime.title.english?.toLowerCase().includes(searchValue)
            );
            displayAnime(filteredAnime);
        }

        // Mood filter
        function filterByMood() {
            if (!moodSearchEnabled) return;

            const moodValue = document.getElementById('moodSlider').value;
            const sliderValueLabel = document.getElementById('sliderValue');

            const moodGenres = {
                1: ['Slice of Life', 'Drama', 'Comedy'], // Sad
                2: ['Mystery', 'Sci-Fi', 'Psychological'], // Neutral
                3: ['Action', 'Adventure', 'Sports'] // Excited
            };

            sliderValueLabel.textContent = `Mood: ${
                moodValue == 1 ? 'Burnt Out' : moodValue == 3 ? 'Excited' : 'Doh Care'
            }`;

            filteredAnime = animeData.filter(anime => 
                anime.genres.some(genre => moodGenres[moodValue].includes(genre))
            );
            displayAnime(filteredAnime);
        }

        // Toggle mood search
        function toggleMoodSearch() {
            moodSearchEnabled = !moodSearchEnabled;
            const moodSearch = document.getElementById('moodSearch');
            const moodToggle = document.getElementById('moodToggle');

            moodSearch.style.display = moodSearchEnabled ? 'block' : 'none';
            moodToggle.textContent = moodSearchEnabled ? 'Disable Mood Search' : 'Enable Mood Search';

            if (!moodSearchEnabled) {
                filteredAnime = [...animeData];
                displayAnime(filteredAnime);
            }
        }

        // Sort anime
        function sortAnime() {
            currentSort = document.getElementById('sortOptions').value;
            currentPage = 1;
            fetchAnime(1, currentSort);
        }

        // Load more anime
        function loadMoreAnime() {
            if (!hasNextPage) return;
            currentPage++;
            fetchAnime(currentPage, currentSort);
        }

        // Initial load
        fetchAnime();
    </script>
</body>
</html>