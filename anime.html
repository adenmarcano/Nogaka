<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Explorer</title>
    <style>
        :root {
            --green: #75A439;
            --teal: #167D9D;
            --dark-purple: #301934;
            --dark-blue: #18203D;
            --text-light: #E0E0E0;
            --text-lighter: #FFFFFF;
            --text-gray: #B0B0B0;
            --bg-dark: #121212;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
        }

        /* Header Section */
        .header {
            background-color: var(--dark-purple);
            padding: 20px;
            border-bottom: 3px solid var(--teal);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header .logo {
            font-size: 2em;
            font-weight: bold;
            color: var(--green);
        }

        .header nav a {
            color: var(--text-lighter);
            text-decoration: none;
            margin: 0 15px;
            font-size: 1.1em;
            transition: color 0.3s ease;
        }

        .header nav a:hover {
            color: var(--green);
        }

        .controls {
            background: var(--dark-purple);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            margin: 20px 0;
            text-align: center;
        }

        label, select, input, button {
            font-size: 1em;
            margin: 10px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--teal);
            background-color: var(--dark-blue);
            color: var(--text-light);
        }

        button:hover {
            background: var(--green);
            color: var(--dark-blue);
        }

        .slider-container {
            margin: 10px auto;
            max-width: 500px;
            text-align: center;
        }

        .slider-label {
            font-size: 1em;
            color: var(--text-lighter);
        }

        #animeContainer {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .anime-card {
            background: var(--dark-blue);
            border-radius: 10px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.3);
            overflow: hidden;
            text-align: center;
            padding: 15px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .anime-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.4);
        }

        .anime-title {
            font-size: 1.2em;
            color: var(--text-lighter);
            margin-bottom: 10px;
        }

        .anime-description {
            font-size: 0.9em;
            color: var(--text-gray);
        }

        .anime-image {
            width: 100%;
            height: auto;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        #loading {
            font-size: 1.2em;
            color: var(--text-gray);
            text-align: center;
        }
    </style>
</head>
<body>
  
  <div id="header-container"></div>
  <div id="footer-container"></div>

  <script>
    // Load Header
    fetch('header.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('header-container').innerHTML = data;
        initHeaderScripts();
      });

    // Header interactions
    function initHeaderScripts() {
      document.querySelector('.btn-signin')?.addEventListener('click', () => {
        alert('Redirecting to Sign In');
      });
      document.querySelector('.btn-signup')?.addEventListener('click', () => {
        alert('Redirecting to Sign Up');
      });
    }

    // Footer interactions
    function initFooterScripts() {
      const copyright =
        document.querySelector('.footer-bottom p');
      if (copyright) {
        const year = new Date().getFullYear();
        copyright.innerHTML = 
          `&copy; ${year} Nogaka. All rights reserved.`;
      }
    }
  </script>
  
    <div class="controls">
        <input type="text" id="searchBar" placeholder="Search anime..." oninput="filterBySearch()" />
        <label for="sortOptions">Sort Anime:</label>
        <select id="sortOptions" onchange="sortAnime()">
            <option value="START_DATE_DESC">Newest</option>
            <option value="POPULARITY_DESC">Popular</option>
        </select>
        <button id="moodToggle" onclick="toggleMoodSearch()">Enable Mood Search</button>
        <div id="moodSearch" class="slider-container" style="display: none;">
            <span class="slider-label" id="sliderValue">Mood: Neutral</span>
            <input type="range" min="1" max="3" value="2" id="moodSlider" oninput="filterByMood()" />
        </div>
    </div>
    <div id="loading">Loading...</div>
    <div id="animeContainer"></div>

    <script>
        const apiUrl = 'https://graphql.anilist.co';

        const graphqlQuery = `
        query($sort: [MediaSort]) {
            Page(page: 1, perPage: 50) {
                media(type: ANIME, sort: $sort) {
                    id
                    title {
                        romaji
                    }
                    coverImage {
                        large
                    }
                    description
                    trailer {
                        site
                        id
                    }
                    genres
                }
            }
        }`;

        let animeData = [];
        let filteredAnime = [];
        let moodSearchEnabled = false;

        // Fetch anime based on sorting
        function fetchAnime(sort = 'START_DATE_DESC') {
            const loadingIndicator = document.getElementById('loading');
            const animeContainer = document.getElementById('animeContainer');

            loadingIndicator.style.display = 'block'; // Show loading
            animeContainer.innerHTML = ''; // Clear previous content

            fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    query: graphqlQuery,
                    variables: { sort },
                }),
            })
            .then(response => response.json())
            .then(data => {
                animeData = data.data.Page.media;
                filteredAnime = [...animeData]; // Clone data for filtering
                loadingIndicator.style.display = 'none'; // Hide loading
                displayAnime(filteredAnime);
            })
            .catch(error => {
                console.error('Error fetching anime data:', error);
                loadingIndicator.style.display = 'none'; // Hide loading
                animeContainer.innerHTML = '<p>Unable to fetch anime data!</p>';
            });
        }

        // Display anime cards
        function displayAnime(animeList) {
            const animeContainer = document.getElementById('animeContainer');
            animeContainer.innerHTML = '';

            animeList.forEach(anime => {
                const animeCard = document.createElement('div');
                animeCard.classList.add('anime-card');

                const animeImage = document.createElement('img');
                animeImage.classList.add('anime-image');
                animeImage.src = anime.coverImage.large;
                animeImage.alt = `${anime.title.romaji} cover image`;

                const animeTitle = document.createElement('p');
                animeTitle.classList.add('anime-title');
                animeTitle.textContent = anime.title.romaji;

                const animeDescription = document.createElement('p');
                animeDescription.classList.add('anime-description');
                animeDescription.innerHTML = anime.description
                    ? anime.description.substring(0, 100) + '...'
                    : 'No description available.';

                // Navigate to YouTube trailer if available
                animeCard.onclick = () => {
                    if (anime.trailer && anime.trailer.site === 'youtube') {
                        window.open(`https://www.youtube.com/watch?v=${anime.trailer.id}`, '_blank');
                    }
                };

                animeCard.appendChild(animeImage);
                animeCard.appendChild(animeTitle);
                animeCard.appendChild(animeDescription);
                animeContainer.appendChild(animeCard);
            });
        }

        // Search anime by title
        function filterBySearch() {
            const searchValue = document.getElementById('searchBar').value.toLowerCase();
            const filtered = animeData.filter(anime =>
                anime.title.romaji.toLowerCase().includes(searchValue)
            );
            displayAnime(filtered);
        }

        // Filter anime by mood/genre
        function filterByMood() {
            if (!moodSearchEnabled) return; // Mood search disabled

            const moodValue = document.getElementById('moodSlider').value;
            const sliderValueLabel = document.getElementById('sliderValue');

            const moods = { 
                1: 'Sad (Slice of Life / Comedy)', 
                2: 'Neutral (Mystery / Sci-Fi)', 
                3: 'Excited (Action / Sports)' 
            };
            sliderValueLabel.textContent = `Mood: ${moods[moodValue]}`;

            const filtered = animeData.filter(anime => {
                if (moodValue == 1) return anime.genres.some(genre =>
                    ['Slice of Life', 'Healing', 'Drama', 'Comedy'].includes(genre)); // Sad mood
                if (moodValue == 3) return anime.genres.some(genre =>
                    ['Action', 'Sports', 'Adventure', 'Fantasy'].includes(genre)); // Excited mood
                return anime.genres.some(genre =>
                    ['Mystery', 'Psychological', 'Sci-Fi', 'Cyberpunk', 'Wholesome'].includes(genre)); // Neutral mood
            });

            displayAnime(filtered);
        }

        // Toggle mood search
        function toggleMoodSearch() {
            moodSearchEnabled = !moodSearchEnabled; // Toggle state
            const moodSearch = document.getElementById('moodSearch');
            const moodToggle = document.getElementById('moodToggle');

            if (moodSearchEnabled) {
                moodSearch.style.display = 'block';
                moodToggle.textContent = 'Disable Mood Search';
            } else {
                moodSearch.style.display = 'none';
                moodToggle.textContent = 'Enable Mood Search';
                displayAnime(animeData); // Reset to full anime list
            }
        }

        // Sort anime by dropdown
        function sortAnime() {
            const sortOption = document.getElementById('sortOptions').value;
            fetchAnime(sortOption);
        }

        // Initial Fetch
        fetchAnime();
    </script>
</body>
</html>
