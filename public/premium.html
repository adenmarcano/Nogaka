<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Slot Machine Game</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      background-color: #121212;
      color: #fff;
      line-height: 1.6;
      font-family: 'Segoe UI', sans-serif;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(117, 164, 57, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(22, 125, 157, 0.15) 0%, transparent 50%),
        linear-gradient(135deg, #121212 0%, #1a1a2e 100%);
      background-attachment: fixed;
      margin: 0;
      padding: 0;
    }

    .slot-machine {
      width: 100%;
      margin: 0 auto;
      background: #301934;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.5);
      position: relative;
      border: 5px solid;
      margin-bottom: 30px;
    }
    
    .slot-reels-container {
      display: flex;
      justify-content: space-between;
      height: 150px;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }
    
    .slot-reel {
      width: 30%;
      height: 100%;
      position: relative;
      overflow: hidden;
      border-radius: 5px;
      background-color: #18203D;
      border: 2px solid;
    }
    
    .reel-strip {
      position: absolute;
      width: 100%;
      transition: none;
    }
    
    .spin-btn {
      display: block;
      width: 100%;
      padding: 15px 0;
      color: white;
      font-size: 18px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    
    .spin-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 20px rgba(0,0,0,0.6);
    }
    
    .slot-symbol {
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      animation: slotGlow 2s infinite alternate;
    }
    
    @keyframes slotGlow {
      from { opacity: 0.8; }
      to { opacity: 1; text-shadow: 0 0 10px currentColor; }
    }
    
    @keyframes symbolWin {
      0% { transform: scale(1); }
      50% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    
    @keyframes fall {
      to {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    @keyframes pulseBorder {
      0% { box-shadow: 0 0 0 0 rgba(117, 164, 57, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(117, 164, 57, 0); }
      100% { box-shadow: 0 0 0 0 rgba(117, 164, 57, 0); }
    }
    
    @keyframes alertIn {
      from { opacity: 0; transform: translateX(-50%) translateY(20px); }
      to { opacity: 1; transform: translateX(-50%) translateY(0); }
    }
    
    @keyframes alertOut {
      from { opacity: 1; transform: translateX(-50%) translateY(0); }
      to { opacity: 0; transform: translateX(-50%) translateY(20px); }
    }

    .promo-banner {
      background: linear-gradient(90deg, #167D9D, #75A439);
      padding: 12px 0;
      text-align: center;
      font-weight: bold;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .confetti {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    .main-container {
      display: flex;
      max-width: 95%;
      margin: 20px auto;
    }

    .content-container {
      background-color: #18203D;
      padding: 20px;
      width: 70%;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(23, 126, 157, 0.3);
      margin-right: 20px;
    }

    .user-stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 15px;
      background: rgba(117, 164, 57, 0.1);
      border-radius: 10px;
    }

    .result-message {
      margin: 30px auto;
      padding: 20px;
      font-size: 22px;
      color: #fff;
      display: none;
      background: rgba(117, 164, 57, 0.2);
      border-radius: 10px;
      max-width: 80%;
      border: 2px solid #75A439;
      animation: pulseBorder 2s infinite;
      text-align: center;
    }

    .jackpot-celebration {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      flex-direction: column;
    }

    .jackpot-content {
      background: linear-gradient(135deg, #18203D, #301934);
      padding: 30px;
      border-radius: 20px;
      text-align: center;
      max-width: 80%;
      border: 3px solid #FFD700;
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
    }

    .premium-box {
      background: linear-gradient(135deg, #301934, #6A0DAD);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(106, 13, 173, 0.5);
    }

    .rewards-chart {
      background: linear-gradient(135deg, #18203D, #167D9D);
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(22, 125, 157, 0.5);
    }

    .rank-box {
      background: linear-gradient(135deg, #18203D, #CD7F32);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(205, 127, 50, 0.5);
    }

    .rank-progress {
      height: 20px;
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      margin: 10px 0;
      overflow: hidden;
    }

    .rank-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #FFD700, #FFA500);
      width: 0%;
      transition: width 0.5s;
    }

    .prestige-btn {
      width: 100%;
      padding: 12px 0;
      background: linear-gradient(90deg, #FFD700, #FFA500);
      color: #301934;
      border: none;
      border-radius: 30px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 10px rgba(255, 215, 0, 0.4);
      margin-top: 10px;
    }

    .winning-line {
      position: absolute;
      width: 100%;
      height: 4px;
      background: #FFD700;
      box-shadow: 0 0 15px #FFD700;
      z-index: 10;
      opacity: 0;
    }

    .active-line {
      opacity: 1;
      animation: pulseBorder 1s infinite;
    }

    /* Premium star in header */
    .premium-star {
      color: gold;
      margin-left: 5px;
      font-size: 0.8em;
    }
    
    /* Leaderboard styles */
    .leaderboard-box {
      background: linear-gradient(135deg, #18203D, #75A439);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 5px 15px rgba(117, 164, 57, 0.5);
    }
    
    .leaderboard-title {
      color: #FFD700;
      margin-top: 0;
      display: flex;
      align-items: center;
    }
    
    .leaderboard-list {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }
    
    .leaderboard-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .leaderboard-rank {
      font-weight: bold;
      color: #FFD700;
      width: 30px;
      text-align: center;
    }
    
    .leaderboard-user {
      flex: 1;
      margin: 0 10px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .leaderboard-stats {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
    }
    
    .leaderboard-level {
      font-weight: bold;
    }
    
    .leaderboard-prestige {
      font-size: 0.8em;
      color: #A45CFF;
    }
    
    .leaderboard-you {
      background: rgba(255, 215, 0, 0.1);
      border-radius: 5px;
      padding: 5px;
    }
  </style>
</head>

<body>
  <!-- Header Include -->
  <div id="header-container"></div>
  
  <!-- Promo Banner with Animation -->
  <div class="promo-banner">
    <span style="animation: pulse 2s infinite;">üéÅ</span> 
    <span class="promo-text" style="position: relative; display: inline-block;">
      Refresh the page to get free coins! Premium users get more!
    </span>
    <div class="confetti"></div>
  </div>

  <!-- Main Content -->
  <div class="main-container">
    <!-- Left Column - Slot Machines -->
    <main class="content-container">
      <!-- User Stats Bar -->
      <div class="user-stats">
        <div style="display: flex; align-items: center;">
          <div style="width: 50px; height: 50px; background: #167D9D; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; font-size: 20px;" id="userAvatar">U</div>
          <div> 
            <h3 style="margin: 0; color: #75A439;" id="loggedInUsername">Player</h3>
            <div style="display: flex; align-items: center; margin-top: 5px;">
              <span style="color: #FFD700; font-weight: bold;">üí∞ <span id="userCoins">0</span> coins</span>
              <span id="premiumBadge" style="margin-left: 15px; padding: 3px 8px; background: linear-gradient(90deg, #FFD700, #FFA500); color: #301934; border-radius: 10px; font-size: 12px; font-weight: bold; display: none;">PREMIUM</span>
              <span id="rankBadge" style="margin-left: 15px; padding: 3px 8px; background: linear-gradient(90deg, #CD7F32, #A67C52); color: white; border-radius: 10px; font-size: 12px; font-weight: bold;">Rank: 1</span>
              <span id="prestigeBadge" style="margin-left: 15px; padding: 3px 8px; background: linear-gradient(90deg, #A45CFF, #6A0DAD); color: white; border-radius: 10px; font-size: 12px; font-weight: bold; display: none;">Prestige: 0</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Bronze Slot Machine -->
      <section style="margin-bottom: 40px;">
        <h2 style="color: #CD7F32; border-bottom: 2px solid #CD7F32; padding-bottom: 10px; display: flex; align-items: center;">
          <span style="margin-right: 10px;">ü•â</span> Bronze Slots (50 coins)
        </h2>
        
        <div id="bronze-slot-machine" class="slot-machine" style="border-color: #CD7F32;">
          <div class="slot-reels-container">
            <!-- Paylines -->
            <div class="winning-line" style="top: 20%;" data-line="top"></div>
            <div class="winning-line" style="top: 50%;" data-line="middle"></div>
            <div class="winning-line" style="top: 80%;" data-line="bottom"></div>
            <!-- Reels will be generated by JavaScript -->
          </div>
          <button class="spin-btn" data-machine="bronze" style="background: linear-gradient(90deg, #CD7F32, #A67C52);">SPIN NOW! (50 coins)</button>
        </div>
      </section>

      <!-- Silver Slot Machine -->
      <section style="margin-bottom: 40px;">
        <h2 style="color: #C0C0C0; border-bottom: 2px solid #C0C0C0; padding-bottom: 10px; display: flex; align-items: center;">
          <span style="margin-right: 10px;">ü•à</span> Silver Slots (200 coins)
        </h2>
        
        <div id="silver-slot-machine" class="slot-machine" style="border-color: #C0C0C0;">
          <div class="slot-reels-container">
            <!-- Paylines -->
            <div class="winning-line" style="top: 20%;" data-line="top"></div>
            <div class="winning-line" style="top: 50%;" data-line="middle"></div>
            <div class="winning-line" style="top: 80%;" data-line="bottom"></div>
            <!-- Reels will be generated by JavaScript -->
          </div>
          <button class="spin-btn" data-machine="silver" style="background: linear-gradient(90deg, #C0C0C0, #A0A0A0);">SPIN NOW! (200 coins)</button>
        </div>
      </section>

      <!-- Gold Slot Machine -->
      <section style="margin-bottom: 40px;">
        <h2 style="color: #FFD700; border-bottom: 2px solid #FFD700; padding-bottom: 10px; display: flex; align-items: center;">
          <span style="margin-right: 10px;">ü•á</span> Gold Slots (500 coins)
        </h2>
        
        <div id="gold-slot-machine" class="slot-machine" style="border-color: #FFD700;">
          <div class="slot-reels-container">
            <!-- Paylines -->
            <div class="winning-line" style="top: 20%;" data-line="top"></div>
            <div class="winning-line" style="top: 50%;" data-line="middle"></div>
            <div class="winning-line" style="top: 80%;" data-line="bottom"></div>
            <!-- Reels will be generated by JavaScript -->
          </div>
          <button class="spin-btn" data-machine="gold" style="background: linear-gradient(90deg, #FFD700, #FFA500);">SPIN NOW! (500 coins)</button>
        </div>
      </section>
      
      <!-- Result Message -->
      <div id="result-message" class="result-message"></div>

      <!-- Jackpot Celebration -->
      <div id="jackpot-celebration" class="jackpot-celebration">
        <div class="jackpot-content">
          <h2 style="color: #FFD700; font-size: 28px; margin-bottom: 20px;">üí∞ JACKPOT! üí∞</h2>
          <p id="jackpot-message" style="font-size: 20px; margin-bottom: 20px;">You won 5000 coins!</p>
          <button id="claim-jackpot-btn" style="
            padding: 12px 24px;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            color: #301934;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            font-size: 18px;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.5);
          ">CLAIM YOUR PRIZE!</button>
        </div>
      </div>
    </main>

    <!-- Right Column - Premium, Ranking and Rewards -->
    <aside style="width: 30%;">
      <!-- Premium Box -->
      <div class="premium-box">
        <h3 style="color: #A45CFF; margin-top: 0; display: flex; align-items: center;">
          <span style="margin-right: 10px;">üíé</span> Premium Membership
        </h3>
        <p style="margin-bottom: 20px;">Upgrade for exclusive benefits!</p>
        
        <div style="margin-bottom: 20px;">
          <p style="display: flex; align-items: center; margin: 10px 0;"><span style="color: #A45CFF; margin-right: 10px;">‚úì</span> Double daily coins</p>
          <p style="display: flex; align-items: center; margin: 10px 0;"><span style="color: #A45CFF; margin-right: 10px;">‚úì</span> Double all rewards</p>
          <p style="display: flex; align-items: center; margin: 10px 0;"><span style="color: #A45CFF; margin-right: 10px;">‚úì</span> Higher win chances</p>
          <p style="display: flex; align-items: center; margin: 10px 0;"><span style="color: #A45CFF; margin-right: 10px;">‚úì</span> Exclusive badges</p>
        </div>
        
        <button id="buy-premium-btn" style="
          width: 100%;
          padding: 12px 0;
          background: linear-gradient(90deg, #A45CFF, #6A0DAD);
          color: white;
          border: none;
          border-radius: 30px;
          font-weight: bold;
          cursor: pointer;
          transition: all 0.3s;
          box-shadow: 0 4px 10px rgba(164, 92, 255, 0.4);
        ">Buy Premium (1000 coins)</button>
        
        <div id="premium-owned" style="
          padding: 12px;
          background: rgba(164, 92, 255, 0.2);
          border-radius: 5px;
          text-align: center;
          color: #A45CFF;
          font-weight: bold;
          display: none;
        ">
          üéâ Premium Activated!
        </div>
      </div>

      <!-- Leaderboard -->
      <div class="leaderboard-box">
        <h3 class="leaderboard-title">
          <span style="margin-right: 10px;">üèÜ</span> Top Players
        </h3>
        
        <ul class="leaderboard-list" id="leaderboard-list">
          <!-- Loading state -->
          <li class="leaderboard-item">
            <div class="leaderboard-rank">-</div>
            <div class="leaderboard-user">Loading leaderboard...</div>
            <div class="leaderboard-stats">
              <div class="leaderboard-level">-</div>
              <div class="leaderboard-prestige">-</div>
            </div>
          </li>
        </ul>
        
        <!-- Current player's rank (shown if not in top 5) -->
        <div id="your-rank" style="margin-top: 15px; padding: 10px; background: rgba(255, 215, 0, 0.1); border-radius: 5px; display: none;">
          <div class="leaderboard-item leaderboard-you">
            <div class="leaderboard-rank">-</div>
            <div class="leaderboard-user">You</div>
            <div class="leaderboard-stats">
              <div class="leaderboard-level">Rank <span id="your-rank-level">1</span></div>
              <div class="leaderboard-prestige">Prestige <span id="your-prestige">0</span></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Ranking System -->
      <div class="rank-box">
        <h3 style="color: #FFD700; margin-top: 0; display: flex; align-items: center;">
          <span style="margin-right: 10px;">üèÖ</span> Rank System
        </h3>
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
          <span>Rank: <span id="current-rank">1</span>/100</span>
          <span>Prestige: <span id="current-prestige">0</span></span>
        </div>
        
        <div class="rank-progress">
          <div class="rank-progress-bar" id="rank-progress-bar"></div>
        </div>
        
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
          <span>XP: <span id="current-xp">0</span>/<span id="next-rank-xp">1000</span></span>
          <span>Multiplier: <span id="rank-multiplier">1</span>x</span>
        </div>
        
        <button id="upgrade-rank-btn" style="
          width: 100%;
          padding: 12px 0;
          background: linear-gradient(90deg, #CD7F32, #A67C52);
          color: white;
          border: none;
          border-radius: 30px;
          font-weight: bold;
          cursor: pointer;
          transition: all 0.3s;
          box-shadow: 0 4px 10px rgba(205, 127, 50, 0.4);
        ">Upgrade Rank (<span id="rank-upgrade-cost">1000</span> coins)</button>
        
        <button id="prestige-btn" class="prestige-btn" style="display: none;">PRESTIGE (Reset to Rank 1 for +1 Multiplier)</button>
      </div>

      <!-- Rewards Chart -->
      <div class="rewards-chart">
        <h3 style="color: #75A439; margin-top: 0; display: flex; align-items: center;">
          <span style="margin-right: 10px;">üèÜ</span> Rewards Chart
        </h3>
        
        <div style="overflow-x: auto;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background: rgba(117, 164, 57, 0.3);">
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #75A439;">Machine</th>
                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #75A439;">Reward</th>
                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #75A439;">Payout</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">ü•â Bronze</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">3x üí∞</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2); text-align: right; color: #FFD700;">100 coins</td>
              </tr>
              <tr>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">ü•â Bronze</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">3x üíµ</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2); text-align: right; color: #FFD700;">250 coins</td>
              </tr>
              <tr>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">ü•à Silver</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">3x üíé</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2); text-align: right; color: #FFD700;">1000 coins</td>
              </tr>
              <tr>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">ü•à Silver</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">3x üèÜ</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2); text-align: right; color: #FFD700;">2500 coins</td>
              </tr>
              <tr>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">ü•á Gold</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2);">3x üíé</td>
                <td style="padding: 10px; border-bottom: 1px solid rgba(117, 164, 57, 0.2); text-align: right; color: #FFD700;">2500 coins</td>
              </tr>
              <tr>
                <td style="padding: 10px;">ü•á Gold</td>
                <td style="padding: 10px;">3x üèÜ</td>
                <td style="padding: 10px; text-align: right; color: #FFD700;">5000 coins</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div style="margin-top: 20px; padding: 10px; background: rgba(255, 215, 0, 0.1); border-radius: 5px; border-left: 3px solid #FFD700;">
          <p style="margin: 5px 0; font-size: 14px;">üí° <strong>Tip:</strong> Premium members get DOUBLE all rewards!</p>
          <p style="margin: 5px 0; font-size: 14px;">üé∞ Any matching pair gives 30% of the reward</p>
          <p style="margin: 5px 0; font-size: 14px;">üèÖ Your rank multiplier applies to all winnings</p>
        </div>
      </div>
    </aside>
  </div>

  <!-- Footer Include -->
  <div id="footer-container"></div>

  <script>
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDTzMzj-WjYucvSuPFOul-53gStIfWiWZg",
      authDomain: "nogaka-bd091.firebaseapp.com",
      projectId: "nogaka-bd091",
      storageBucket: "nogaka-bd091.appspot.com",
      messagingSenderId: "910853337142",
      appId: "1:910853337142:web:a38f0109f2d5012529e897"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // User Data with ranking system
    let user = {
      coins: 0,
      premium: false,
      lastRefresh: null,
      username: "Player",
      rank: 1,
      xp: 0,
      prestige: 0,
      multiplier: 1
    };

    // Load user data from Firebase or localStorage
    function loadUserData() {
    // Check Firebase auth state first
    auth.onAuthStateChanged(firebaseUser => {
      if (firebaseUser) {
        // Clear localStorage when a new user logs in
        localStorage.removeItem('slotUser');
        
        // Load data from Firestore
        db.collection('users').doc(firebaseUser.uid).get().then(doc => {
          if (doc.exists) {
            const firestoreData = doc.data();
            // Reset user object with default values first
            user = {
              coins: 0,
              premium: false,
              lastRefresh: null,
              username: firebaseUser.displayName || firebaseUser.email.split('@')[0],
              rank: 1,
              xp: 0,
              prestige: 0,
              multiplier: 1
            };
            // Then merge with Firestore data
            Object.assign(user, firestoreData);
            
            updateUI();
            checkRefreshCoins(); // Give coins on every load
            updatePremiumStar();
            loadLeaderboard();
          } else {
            // Create new user document with default values
            user = {
              coins: 100, // Starting coins
              premium: false,
              lastRefresh: null,
              username: firebaseUser.displayName || firebaseUser.email.split('@')[0],
              rank: 1,
              xp: 0,
              prestige: 0,
              multiplier: 1
            };
            db.collection('users').doc(firebaseUser.uid).set(user);
            checkRefreshCoins(); // Give coins for new user
          }
        });
        
        document.getElementById('loggedInUsername').textContent = user.username;
      } else {
        // Not logged in, use local data (guest mode)
        const savedUser = localStorage.getItem('slotUser');
        if (savedUser) {
          Object.assign(user, JSON.parse(savedUser));
        } else {
          // Initialize new guest user with starting coins
          user = {
            coins: 100,
            premium: false,
            lastRefresh: null,
            username: "Guest",
            rank: 1,
            xp: 0,
            prestige: 0,
            multiplier: 1
          };
        }
        updateUI();
        checkRefreshCoins(); // Give coins on every load
      }
    });
  }

    // Load leaderboard data from Firebase
    function loadLeaderboard() {
    const leaderboardList = document.getElementById('leaderboard-list');
    leaderboardList.innerHTML = '<li class="leaderboard-item"><div class="leaderboard-rank">-</div><div class="leaderboard-user">Loading leaderboard...</div><div class="leaderboard-stats"><div class="leaderboard-level">-</div><div class="leaderboard-prestige">-</div></div></li>';

    // Fetch the top 3 players by prestige and rank
    db.collection('users')
        .orderBy('prestige', 'desc')
        .orderBy('rank', 'desc')
        .limit(3) // Limit to top 3 players
        .get()
        .then(snapshot => {
            leaderboardList.innerHTML = ''; // Clear loading message

            if (snapshot.empty) {
                leaderboardList.innerHTML = '<li class="leaderboard-item"><div class="leaderboard-user">No players found</div></li>';
                return;
            }

            let rank = 1;
            snapshot.forEach(doc => {
                const player = doc.data();
                const item = document.createElement('li');
                item.className = 'leaderboard-item';

                // Highlight if it's the current user
                if (auth.currentUser && doc.id === auth.currentUser.uid) {
                    item.classList.add('leaderboard-you');
                    document.getElementById('your-rank').style.display = 'none'; // Hide "you" section since they're in top 3
                }

                item.innerHTML = `
                    <div class="leaderboard-rank">${rank}</div>
                    <div class="leaderboard-user">${player.username || 'Anonymous'}</div>
                    <div class="leaderboard-stats">
                        <div class="leaderboard-level">Rank ${player.rank || 1}</div>
                        <div class="leaderboard-prestige">Prestige ${player.prestige || 0}</div>
                    </div>
                `;

                leaderboardList.appendChild(item);
                rank++;
            });

            // If the current user isn't in the top 3, show their rank separately
            if (auth.currentUser && !snapshot.docs.some(doc => doc.id === auth.currentUser.uid)) {
                db.collection('users').doc(auth.currentUser.uid).get().then(doc => {
                    if (doc.exists) {
                        const player = doc.data();
                        document.getElementById('your-rank-level').textContent = player.rank || 1;
                        document.getElementById('your-prestige').textContent = player.prestige || 0;
                        document.getElementById('your-rank').style.display = 'block';
                    }
                });
            }
        })
        .catch(error => {
            console.error("Error loading leaderboard:", error);
            leaderboardList.innerHTML = '<li class="leaderboard-item"><div class="leaderboard-user">Error loading leaderboard</div></li>';
        });
}

    // Update premium star in header
    function updatePremiumStar() {
      const accountBtnText = document.getElementById('accountBtnText');
      if (accountBtnText) {
        const star = accountBtnText.querySelector('.premium-star');
        if (user.premium) {
          if (!star) {
            const starElement = document.createElement('span');
            starElement.className = 'premium-star';
            starElement.innerHTML = ' ‚≠ê';
            accountBtnText.appendChild(starElement);
          }
        } else if (star) {
          star.remove();
        }
      }
    }

    // Check and give refresh coins if eligible
    function checkRefreshCoins() {
  const baseCoins = user.premium ? 200 : 100;
  const refreshCoins = baseCoins * user.multiplier;
  
  user.coins += refreshCoins;
  user.lastRefresh = new Date().toISOString();
  
  showAlert(`+${refreshCoins} coins added for refreshing the page!`, "#75A439");
  saveUserData();
  updateUI();
}
    function saveUserData() {
      // Only save to localStorage if not logged in (guest mode)
      if (!auth.currentUser) {
        localStorage.setItem('slotUser', JSON.stringify(user));
      }
      
      // Always save to Firestore if logged in
      if (auth.currentUser) {
        db.collection('users').doc(auth.currentUser.uid).set(user, { merge: true })
          .catch(error => {
            console.error("Error saving user data:", error);
          });
      }
    }

    // Update UI with current user data
    function updateUI() {
      document.getElementById('userCoins').textContent = user.coins;
      document.getElementById('loggedInUsername').textContent = user.username;
      document.getElementById('current-rank').textContent = user.rank;
      document.getElementById('current-xp').textContent = user.xp;
      document.getElementById('next-rank-xp').textContent = user.rank * 1000;
      document.getElementById('rank-multiplier').textContent = user.multiplier;
      document.getElementById('current-prestige').textContent = user.prestige;
      document.getElementById('rank-upgrade-cost').textContent = user.rank * 1000;
      
      // Update progress bar
      const progressPercent = (user.xp / (user.rank * 1000)) * 100;
      document.getElementById('rank-progress-bar').style.width = `${progressPercent}%`;
      
      // Update badges
      if (user.premium) {
        document.getElementById('premiumBadge').style.display = 'block';
        document.getElementById('premium-owned').style.display = 'block';
        document.getElementById('buy-premium-btn').style.display = 'none';
      } else {
        document.getElementById('premiumBadge').style.display = 'none';
        document.getElementById('premium-owned').style.display = 'none';
        document.getElementById('buy-premium-btn').style.display = 'block';
      }
      
      document.getElementById('rankBadge').textContent = `Rank: ${user.rank}`;
      
      if (user.prestige > 0) {
        document.getElementById('prestigeBadge').style.display = 'block';
        document.getElementById('prestigeBadge').textContent = `Prestige: ${user.prestige}`;
      } else {
        document.getElementById('prestigeBadge').style.display = 'none';
      }
      
      // Show/hide prestige button
      if (user.rank >= 100) {
        document.getElementById('prestige-btn').style.display = 'block';
      } else {
        document.getElementById('prestige-btn').style.display = 'none';
      }
    }

    // Slot machine configurations with adjusted payouts
    const slotConfigs = {
      bronze: {
        cost: 50,
        symbols: [
          { name: "100 Coins", emoji: "üí∞", color: "#FFD700", weight: 50, payout: 100 },
          { name: "250 Coins", emoji: "üíµ", color: "#75A439", weight: 40, payout: 250 },
          { name: "Free Spin", emoji: "üé∞", color: "#167D9D", weight: 30, payout: 0 },
          { name: "Try Again", emoji: "üîÑ", color: "#CD7F32", weight: 5, payout: 0 }
        ],
        jackpot: 250
      },
      silver: {
        cost: 200,
        symbols: [
          { name: "250 Coins", emoji: "üí∞", color: "#FFD700", weight: 40, payout: 250 },
          { name: "1000 Coins", emoji: "üíé", color: "#A45CFF", weight: 30, payout: 1000 },
          { name: "2500 Coins", emoji: "üèÜ", color: "#FFD700", weight: 10, payout: 2500, isJackpot: true },
          { name: "Free Spin", emoji: "üé∞", color: "#C0C0C0", weight: 20, payout: 0 }
        ],
        jackpot: 2500
      },
      gold: {
        cost: 500,
        symbols: [
          { name: "500 Coins", emoji: "üí∞", color: "#FFD700", weight: 35, payout: 500 },
          { name: "2500 Coins", emoji: "üíé", color: "#A45CFF", weight: 25, payout: 2500 },
          { name: "5000 Coins", emoji: "üèÜ", color: "#FFD700", weight: 8, payout: 5000, isJackpot: true },
          { name: "Free Spin", emoji: "üé∞", color: "#FFD700", weight: 15, payout: 0 }
        ],
        jackpot: 5000
      }
    };

    // Initialize all slot machines
    function initializeSlots() {
      for (const [machine, config] of Object.entries(slotConfigs)) {
        const container = document.getElementById(`${machine}-slot-machine`).querySelector('.slot-reels-container');
        container.innerHTML = '';
        
        // Create weighted symbol array for randomization
        let weightedSymbols = [];
        config.symbols.forEach(symbol => {
          for (let i = 0; i < symbol.weight; i++) {
            weightedSymbols.push(symbol);
          }
        });
        
        for (let i = 0; i < 3; i++) {
          const reel = document.createElement('div');
          reel.className = 'slot-reel';
          reel.style.width = '30%';
          reel.style.height = '100%';
          reel.style.position = 'relative';
          reel.style.overflow = 'hidden';
          reel.style.borderRadius = '5px';
          reel.style.backgroundColor = '#18203D';
          reel.style.border = '2px solid ' + (machine === 'bronze' ? '#CD7F32' : machine === 'silver' ? '#C0C0C0' : '#FFD700');
          
          // Create reel strip with symbols
          const reelStrip = document.createElement('div');
          reelStrip.className = 'reel-strip';
          reelStrip.style.position = 'absolute';
          reelStrip.style.width = '100%';
          reelStrip.style.transition = 'none';
          
          // Add symbols to the strip (5 visible symbols per reel)
          for (let j = 0; j < 20; j++) {
            const randomSymbol = weightedSymbols[Math.floor(Math.random() * weightedSymbols.length)];
            const symbolElement = document.createElement('div');
            symbolElement.className = 'slot-symbol';
            symbolElement.style.height = '50px';
            symbolElement.style.display = 'flex';
            symbolElement.style.alignItems = 'center';
            symbolElement.style.justifyContent = 'center';
            symbolElement.style.fontSize = '30px';
            symbolElement.textContent = randomSymbol.emoji;
            symbolElement.setAttribute('data-name', randomSymbol.name);
            symbolElement.setAttribute('data-color', randomSymbol.color);
            symbolElement.setAttribute('data-payout', randomSymbol.payout);
            symbolElement.setAttribute('data-jackpot', randomSymbol.isJackpot || false);
            reelStrip.appendChild(symbolElement);
          }
          
          reel.appendChild(reelStrip);
          container.appendChild(reel);
        }
        
        // Add paylines
        const paylines = ['top', 'middle', 'bottom'];
        paylines.forEach(line => {
          const payline = document.createElement('div');
          payline.className = 'winning-line';
          payline.style.position = 'absolute';
          payline.style.top = line === 'top' ? '20%' : line === 'middle' ? '50%' : '80%';
          payline.style.left = '0';
          payline.style.width = '100%';
          payline.style.height = '4px';
          payline.style.background = '#FFD700';
          payline.style.boxShadow = '0 0 15px #FFD700';
          payline.style.zIndex = '10';
          payline.style.opacity = '0';
          payline.setAttribute('data-line', line);
          container.appendChild(payline);
        });
      }
    }

    // Spin functionality
    let spinning = false;
    
    document.querySelectorAll('.spin-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        if (spinning) return;
        
        const machine = this.getAttribute('data-machine');
        const config = slotConfigs[machine];
        
        // Check if user has enough coins
        if (user.coins < config.cost) {
          showAlert(`You need at least ${config.cost} coins to spin!`, "#FF6B6B");
          return;
        }
        
        spinning = true;
        
        // Deduct coins
        user.coins -= config.cost;
        saveUserData();
        updateUI();
        
        // Button click effect
        this.style.transform = 'translateY(2px)';
        
        // Disable all buttons during spin
        document.querySelectorAll('.spin-btn').forEach(b => b.disabled = true);
        this.textContent = 'SPINNING...';
        document.getElementById('result-message').style.display = 'none';
        
        // Hide all winning lines
        document.querySelectorAll('.winning-line').forEach(line => {
          line.classList.remove('active-line');
        });
        
        const reels = document.querySelectorAll(`#${machine}-slot-machine .reel-strip`);
        const results = [];
        
        reels.forEach((reel, index) => {
          // Reset position
          reel.style.transition = 'none';
          reel.style.top = '0px';
          
          // Force reflow
          void reel.offsetHeight;
          
          // Calculate random stop position (centered on middle row)
          const symbolHeight = 50;
          const totalSymbols = reel.children.length;
          const randomOffset = Math.floor(Math.random() * totalSymbols);
          const stopPosition = -((randomOffset * symbolHeight) + (symbolHeight * 1)); // 1 = middle row
          
          // Add slight delay between reels
          setTimeout(() => {
            reel.style.transition = 'top 2s cubic-bezier(0.1, 0.5, 0.3, 1)';
            reel.style.top = `${stopPosition}px`;
            
            // Get the result symbols (all three rows)
            setTimeout(() => {
              const topIndex = randomOffset % totalSymbols;
              const middleIndex = (randomOffset + 1) % totalSymbols;
              const bottomIndex = (randomOffset + 2) % totalSymbols;
              
              results.push({
                top: {
                  symbol: reel.children[topIndex],
                  name: reel.children[topIndex].getAttribute('data-name'),
                  color: reel.children[topIndex].getAttribute('data-color'),
                  emoji: reel.children[topIndex].textContent,
                  payout: parseInt(reel.children[topIndex].getAttribute('data-payout')),
                  isJackpot: reel.children[topIndex].getAttribute('data-jackpot') === 'true'
                },
                middle: {
                  symbol: reel.children[middleIndex],
                  name: reel.children[middleIndex].getAttribute('data-name'),
                  color: reel.children[middleIndex].getAttribute('data-color'),
                  emoji: reel.children[middleIndex].textContent,
                  payout: parseInt(reel.children[middleIndex].getAttribute('data-payout')),
                  isJackpot: reel.children[middleIndex].getAttribute('data-jackpot') === 'true'
                },
                bottom: {
                  symbol: reel.children[bottomIndex],
                  name: reel.children[bottomIndex].getAttribute('data-name'),
                  color: reel.children[bottomIndex].getAttribute('data-color'),
                  emoji: reel.children[bottomIndex].textContent,
                  payout: parseInt(reel.children[bottomIndex].getAttribute('data-payout')),
                  isJackpot: reel.children[bottomIndex].getAttribute('data-jackpot') === 'true'
                }
              });
              
              // Check if all reels have stopped
              if (results.length === reels.length) {
                evaluateResults(machine, results, config);
              }
            }, 2000);
          }, index * 300);
        });
      });
    });
    
    // Evaluate the spin results (all three paylines)
    function evaluateResults(machine, results, config) {
      spinning = false;
      
      // Re-enable buttons
      document.querySelectorAll('.spin-btn').forEach(b => {
        b.disabled = false;
        b.style.transform = 'none';
        b.textContent = `SPIN NOW! (${slotConfigs[b.getAttribute('data-machine')].cost} coins)`;
      });
      
      // Check each payline for matches
      const paylines = {
        top: results.map(r => r.top),
        middle: results.map(r => r.middle),
        bottom: results.map(r => r.bottom)
      };
      
      let totalWin = 0;
      let winningLines = [];
      
      // Check each payline for matches
      for (const [lineName, lineSymbols] of Object.entries(paylines)) {
        const uniqueSymbols = [...new Set(lineSymbols.map(s => s.name))];
        
        if (uniqueSymbols.length === 1) {
          // All symbols match on this line
          let payout = lineSymbols[0].payout * user.multiplier;
          
          // Double payout for premium users
          if (user.premium) {
            payout *= 2;
          }
          
          totalWin += payout;
          winningLines.push({ line: lineName, payout: payout, symbol: lineSymbols[0] });
          
          // Highlight winning symbols
          lineSymbols.forEach(s => s.symbol.style.animation = 'symbolWin 0.5s 3');
        } 
        else if (uniqueSymbols.length === 2) {
          // Two matching symbols (partial win)
          const matchingSymbol = lineSymbols.find(s => 
            lineSymbols.filter(x => x.name === s.name).length >= 2
          );
          
          if (matchingSymbol && matchingSymbol.payout > 0) {
            let partialPayout = Math.floor(matchingSymbol.payout * 0.3) * user.multiplier;
            
            // Double payout for premium users
            if (user.premium) {
              partialPayout *= 2;
            }
            
            totalWin += partialPayout;
            winningLines.push({ line: lineName, payout: partialPayout, symbol: matchingSymbol, partial: true });
            
            // Highlight matching symbols
            lineSymbols.filter(s => s.name === matchingSymbol.name).forEach(s => {
              s.symbol.style.animation = 'symbolWin 0.5s 3';
            });
          }
        }
      }
      
      // Show winning lines
      winningLines.forEach(win => {
        const lineElement = document.querySelector(`#${machine}-slot-machine .winning-line[data-line="${win.line}"]`);
        if (lineElement) {
          lineElement.classList.add('active-line');
        }
      });
      
      // Add XP for playing (win or lose)
      user.xp += 10;
      checkRankUp();
      
      if (totalWin > 0) {
        user.coins += totalWin;
        
        // Check for jackpot
        const jackpotWin = winningLines.find(win => win.symbol.isJackpot && !win.partial);
        
        if (jackpotWin) {
          // JACKPOT WIN
          document.getElementById('jackpot-message').textContent = `You won ${jackpotWin.payout} coins!`;
          document.getElementById('jackpot-celebration').style.display = 'flex';
          
          // Intense confetti
          createConfetti(200);
          setTimeout(() => createConfetti(200), 500);
          setTimeout(() => createConfetti(200), 1000);
          
          showAlert(`JACKPOT! You won ${jackpotWin.payout} coins!`, "#FFD700");
        } else {
          // Regular win
          const winMessage = winningLines.map(win => 
            `${win.line.toUpperCase()} line: ${win.partial ? 'Partial ' : ''}Win ${win.payout} coins ${win.symbol.emoji}`
          ).join('<br>');
          
          document.getElementById('result-message').innerHTML = winMessage;
          document.getElementById('result-message').style.display = 'block';
          document.getElementById('result-message').style.color = winningLines[0].symbol.color;
          
          createConfetti(50);
          showAlert(`You won ${totalWin} coins!`, winningLines[0].symbol.color);
        }
      } else {
        // No wins
        document.getElementById('result-message').textContent = "No win this time. Try again!";
        document.getElementById('result-message').style.display = 'block';
        document.getElementById('result-message').style.color = "#167D9D";
        showAlert("No win this time. Try again!", "#167D9D");
      }
      
      saveUserData();
      updateUI();
      loadLeaderboard(); // Update leaderboard after win
    }
    
    // Check if user can rank up
    function checkRankUp() {
      const xpNeeded = user.rank * 1000;
      
      if (user.xp >= xpNeeded && user.rank < 100) {
        user.xp -= xpNeeded;
        user.rank++;
        showAlert(`üéâ Rank Up! You are now Rank ${user.rank}`, "#FFD700");
        createConfetti(100);
        
        // Check if reached max rank for prestige
        if (user.rank >= 100) {
          showAlert("üéâ Max Rank Reached! You can now Prestige for a permanent multiplier!", "#A45CFF");
          document.getElementById('prestige-btn').style.display = 'block';
        }
        
        saveUserData();
        updateUI();
        loadLeaderboard(); // Update leaderboard after rank up
      }
    }
    
    // Buy Premium button
    document.getElementById('buy-premium-btn').addEventListener('click', function() {
      if (user.premium) return;
      
      if (user.coins < 1000) {
        showAlert("You need 1000 coins to buy Premium!", "#FF6B6B");
        return;
      }
      
      user.coins -= 1000;
      user.premium = true;
      saveUserData();
      updateUI();
      updatePremiumStar();
      
      showAlert("üéâ Premium unlocked! You now get double refresh coins and double all rewards!", "#A45CFF");
      createConfetti(100);
    });
    
    // Upgrade Rank button
    document.getElementById('upgrade-rank-btn').addEventListener('click', function() {
      const upgradeCost = user.rank * 1000;
      
      if (user.coins < upgradeCost) {
        showAlert(`You need ${upgradeCost} coins to upgrade your rank!`, "#FF6B6B");
        return;
      }
      
      if (user.rank >= 100) {
        showAlert("You've reached max rank! Prestige to continue progressing.", "#A45CFF");
        return;
      }
      
      user.coins -= upgradeCost;
      user.xp += upgradeCost / 2; // Give some XP for buying rank
      checkRankUp();
      saveUserData();
      updateUI();
      
      showAlert(`+${upgradeCost / 2} XP added to your rank progress!`, "#75A439");
    });
    
    // Prestige button
    document.getElementById('prestige-btn').addEventListener('click', function() {
      if (user.rank < 100) return;
      
      if (confirm("Prestige will reset your rank to 1 but give you a permanent +1 multiplier. Continue?")) {
        user.prestige++;
        user.multiplier++;
        user.rank = 1;
        user.xp = 0;
        saveUserData();
        updateUI();
        loadLeaderboard(); // Update leaderboard after prestige
        
        showAlert(`üéâ Prestige ${user.prestige} achieved! Your multiplier is now ${user.multiplier}x`, "#A45CFF");
        createConfetti(200);
      }
    });
    
    // Claim Jackpot button
    document.getElementById('claim-jackpot-btn').addEventListener('click', function() {
      document.getElementById('jackpot-celebration').style.display = 'none';
      document.getElementById('result-message').innerHTML = 'üí∞ JACKPOT claimed! Check your coin balance! üí∞';
      document.getElementById('result-message').style.display = 'block';
      document.getElementById('result-message').style.color = '#FFD700';
    });
    
    // Create confetti effect
    function createConfetti(count = 50) {
      const confettiContainer = document.querySelector('.confetti');
      confettiContainer.innerHTML = '';
      
      for (let i = 0; i < count; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'absolute';
        confetti.style.width = '10px';
        confetti.style.height = '10px';
        confetti.style.backgroundColor = getRandomColor();
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.top = '-10px';
        confetti.style.opacity = '0';
        confetti.style.transform = 'rotate(0deg)';
        confetti.style.animation = `fall ${3 + Math.random() * 5}s linear forwards`;
        
        confettiContainer.appendChild(confetti);
        
        // Fade in
        setTimeout(() => {
          confetti.style.opacity = '0.8';
        }, 100);
      }
    }
    
    // Show alert message
    function showAlert(text, color) {
      const alertBox = document.createElement('div');
      alertBox.textContent = text;
      alertBox.style.position = 'fixed';
      alertBox.style.bottom = '20px';
      alertBox.style.left = '50%';
      alertBox.style.transform = 'translateX(-50%)';
      alertBox.style.padding = '15px 25px';
      alertBox.style.background = color;
      alertBox.style.color = '#fff';
      alertBox.style.borderRadius = '10px';
      alertBox.style.fontWeight = 'bold';
      alertBox.style.boxShadow = '0 5px 15px rgba(0,0,0,0.5)';
      alertBox.style.zIndex = '1000';
      alertBox.style.animation = 'alertIn 0.3s forwards, alertOut 0.3s forwards 2s';
      
      document.body.appendChild(alertBox);
      
      setTimeout(() => {
        alertBox.remove();
      }, 2300);
    }
    
    function getRandomColor() {
      const colors = ['#75A439', '#167D9D', '#FFD700', '#FF6B6B', '#A45CFF'];
      return colors[Math.floor(Math.random() * colors.length)];
    }
    
    // Initialize the game
    window.addEventListener('DOMContentLoaded', () => {
      loadUserData();
      initializeSlots();
      
      // Set up header after it loads
      fetch('header.html')
        .then(response => response.text())
        .then(data => {
          document.getElementById('header-container').innerHTML = data;
          setTimeout(() => {
            initHeaderScripts();
            updatePremiumStar(); // Ensure star shows up if user is premium
          }, 200);
        })
        .catch(error => console.error("Error loading header:", error));
    });

    // Header interactions (runs after header loads)
    function initHeaderScripts() {
      const accountBtn = document.getElementById('accountBtn');
      const dropdownContent = document.getElementById('dropdownContent');
      const accountBtnText = document.getElementById('accountBtnText');
      const accountDropdown = document.querySelector('.user-dropdown');

      if (accountBtn && dropdownContent && accountBtnText) {
        accountBtn.addEventListener('click', () => {
          accountDropdown.classList.toggle('active');
        });

        // Check Firebase authentication state
        auth.onAuthStateChanged(firebaseUser => {
          if (firebaseUser) {
            // Fetch user data from Firestore
            db.collection('users').doc(firebaseUser.uid).get().then((doc) => {
              if (doc.exists) {
                const userData = doc.data();
                const userName = userData.username || user.email;
                accountBtnText.textContent = userName;
                
                updateUI();
                updatePremiumStar();

                dropdownContent.innerHTML = `
                  <a href="#" id="signOutLink"><i class="fas fa-sign-out-alt"></i> Sign Out</a>
                  <a href="favourites.html"><i class="fas fa-heart"></i> Favorites</a>
                  <a href="aboutus.html"><i class="fas fa-info-circle"></i> About us</a>
                `;

                document.getElementById('signOutLink').addEventListener('click', (e) => {
                  e.preventDefault();
                  auth.signOut().then(() => {
                    // Clear localStorage on sign out
                    localStorage.removeItem('slotUser');
                    dropdownContent.style.display = "none";
                    accountBtnText.textContent = "Account";
                    window.location.reload();
                  });
                });
              }
            });
          } else {
            dropdownContent.innerHTML = `
              <a href="account.html?action=signin"><i class="fas fa-sign-in-alt"></i> Sign In</a>
              <a href="account.html?action=create"><i class="fas fa-user-plus"></i> Create Account</a>
              <a href="aboutus.html"><i class="fas fa-info-circle"></i> About us</a>
            `;
            accountBtnText.textContent = "Account";
          }
        });

        document.addEventListener("click", (event) => {
          if (!accountDropdown.contains(event.target)) {
            accountDropdown.classList.remove("active");
          }
        });
      }
    }

    // Load footer
    fetch('footer.html')
      .then(response => response.text())
      .then(data => {
        document.getElementById('footer-container').innerHTML = data;
      })
      .catch(error => console.error("Error loading footer:", error));
  </script>
</body>
</html>