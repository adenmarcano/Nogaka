<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Explorer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        h1 {
            font-size: 2em;
            color: #333;
        }
        label, select, input, button {
            font-size: 1em;
            margin: 10px;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        .controls {
            margin-bottom: 20px;
        }
        .slider-container {
            margin: 10px auto;
            max-width: 500px;
            text-align: center;
        }
        .slider-label {
            font-size: 1em;
            margin: 10px;
        }
        #animeContainer {
            margin: 20px auto;
            max-width: 1000px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }
        .anime-card {
            background-color: #ffffff;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .anime-card:hover {
            transform: scale(1.05);
        }
        .anime-title {
            font-size: 1.2em;
            color: #333;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .anime-description {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
        }
        .anime-image {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        #loading {
            font-size: 1.2em;
            color: #666;
            display: none;
        }
        #moodToggle {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        #moodToggle:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Anime Explorer</h1>
    <div class="controls">
        <input type="text" id="searchBar" placeholder="Search anime..." oninput="filterBySearch()" />
        <label for="sortOptions">Sort Anime:</label>
        <select id="sortOptions" onchange="sortAnime()">
            <option value="START_DATE_DESC">Newest</option>
            <option value="POPULARITY_DESC">Popular</option>
        </select>
        <button id="moodToggle" onclick="toggleMoodSearch()">Enable Mood Search</button>
        <div id="moodSearch" class="slider-container" style="display: none;">
            <span class="slider-label" id="sliderValue">Mood: Neutral</span>
            <input type="range" min="1" max="3" value="2" id="moodSlider" oninput="filterByMood()" />
        </div>
    </div>
    <div id="loading">Loading...</div>
    <div id="animeContainer"></div>

    <script>
        const apiUrl = 'https://graphql.anilist.co';

        const graphqlQuery = `
        query($sort: [MediaSort]) {
            Page(page: 1, perPage: 50) {
                media(type: ANIME, sort: $sort) {
                    id
                    title {
                        romaji
                    }
                    coverImage {
                        large
                    }
                    description
                    trailer {
                        site
                        id
                    }
                    genres
                }
            }
        }`;

        let animeData = [];
        let filteredAnime = [];
        let moodSearchEnabled = false;

        // Fetch anime based on sorting
        function fetchAnime(sort = 'START_DATE_DESC') {
            const loadingIndicator = document.getElementById('loading');
            const animeContainer = document.getElementById('animeContainer');

            loadingIndicator.style.display = 'block'; // Show loading
            animeContainer.innerHTML = ''; // Clear previous content

            fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    query: graphqlQuery,
                    variables: { sort },
                }),
            })
            .then(response => response.json())
            .then(data => {
                animeData = data.data.Page.media;
                filteredAnime = [...animeData]; // Clone data for filtering
                loadingIndicator.style.display = 'none'; // Hide loading
                displayAnime(filteredAnime);
            })
            .catch(error => {
                console.error('Error fetching anime data:', error);
                loadingIndicator.style.display = 'none'; // Hide loading
                animeContainer.innerHTML = '<p>Unable to fetch anime data!</p>';
            });
        }

        // Display anime cards
        function displayAnime(animeList) {
            const animeContainer = document.getElementById('animeContainer');
            animeContainer.innerHTML = '';

            animeList.forEach(anime => {
                const animeCard = document.createElement('div');
                animeCard.classList.add('anime-card');

                const animeImage = document.createElement('img');
                animeImage.classList.add('anime-image');
                animeImage.src = anime.coverImage.large;
                animeImage.alt = `${anime.title.romaji} cover image`;

                const animeTitle = document.createElement('p');
                animeTitle.classList.add('anime-title');
                animeTitle.textContent = anime.title.romaji;

                const animeDescription = document.createElement('p');
                animeDescription.classList.add('anime-description');
                animeDescription.innerHTML = anime.description
                    ? anime.description.substring(0, 100) + '...'
                    : 'No description available.';

                // Navigate to YouTube trailer if available
                animeCard.onclick = () => {
                    if (anime.trailer && anime.trailer.site === 'youtube') {
                        window.open(`https://www.youtube.com/watch?v=${anime.trailer.id}`, '_blank');
                    }
                };

                animeCard.appendChild(animeImage);
                animeCard.appendChild(animeTitle);
                animeCard.appendChild(animeDescription);
                animeContainer.appendChild(animeCard);
            });
        }

        // Search anime by title
        function filterBySearch() {
            const searchValue = document.getElementById('searchBar').value.toLowerCase();
            const filtered = animeData.filter(anime =>
                anime.title.romaji.toLowerCase().includes(searchValue)
            );
            displayAnime(filtered);
        }

        // Filter anime by mood/genre
        function filterByMood() {
            if (!moodSearchEnabled) return; // Mood search disabled

            const moodValue = document.getElementById('moodSlider').value;
            const sliderValueLabel = document.getElementById('sliderValue');

            const moods = { 
                1: 'Sad (Slice of Life / Comedy)', 
                2: 'Neutral (Mystery / Sci-Fi)', 
                3: 'Excited (Action / Sports)' 
            };
            sliderValueLabel.textContent = `Mood: ${moods[moodValue]}`;

            const filtered = animeData.filter(anime => {
                if (moodValue == 1) return anime.genres.some(genre =>
                    ['Slice of Life', 'Healing', 'Drama', 'Comedy'].includes(genre)); // Sad mood
                if (moodValue == 3) return anime.genres.some(genre =>
                    ['Action', 'Sports', 'Adventure', 'Fantasy'].includes(genre)); // Excited mood
                return anime.genres.some(genre =>
                    ['Mystery', 'Psychological', 'Sci-Fi', 'Cyberpunk', 'Wholesome'].includes(genre)); // Neutral mood
            });

            displayAnime(filtered);
        }

        // Toggle mood search
        function toggleMoodSearch() {
            moodSearchEnabled = !moodSearchEnabled; // Toggle state
            const moodSearch = document.getElementById('moodSearch');
            const moodToggle = document.getElementById('moodToggle');

            if (moodSearchEnabled) {
                moodSearch.style.display = 'block';
                moodToggle.textContent = 'Disable Mood Search';
            } else {
                moodSearch.style.display = 'none';
                moodToggle.textContent = 'Enable Mood Search';
                displayAnime(animeData); // Reset to full anime list
            }
        }

        // Sort anime by dropdown
        function sortAnime() {
            const sortOption = document.getElementById('sortOptions').value;
            fetchAnime(sortOption);
        }

        // Initial Fetch
        fetchAnime();
    </script>
</body>
</html>
